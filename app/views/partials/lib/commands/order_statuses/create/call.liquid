{% liquid
  function_rc order = 'lib/queries/orders/find', id: order_id

  include 'lib/commands/order_statuses/create/build', order: order, current_user_id: context.current_user.id, name: name
  include 'lib/commands/order_statuses/create/check', object: context.exports.object

  if context.exports.object.valid
    include 'lib/commands/order_statuses/create/execute', object: context.exports.object

    if context.exports.object.valid
      assign object = context.exports.object
      include 'lib/commands/events/create', type: 'order_status_created', actor_id: context.current_user.id, target_id: object.order_id, object_id: object.id
    endif
  else
    echo context.exports.object
    echo 'failed'
  endif
%}
