{% background "bg-task-name", type: type, object_id: object_id, actor_id: actor_id, target_id: target_id %}
{% liquid
  include 'lib/events/build', type: type, actor_id: actor_id, object_id: object_id, target_id: target_id
  include 'lib/events/validate', event: context.exports.event

  if context.exports.event.valid
    include 'lib/events/create', event: context.exports.event
    log context.exports.event.payload.type, type: 'info.events.created'

    include 'lib/events/broadcast', event: context.exports.event
  else
    log context.exports.event, type: 'errors.events.invalid'
  endif
%}
{% endbackground %}
