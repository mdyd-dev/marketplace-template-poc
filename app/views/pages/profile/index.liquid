---
slug: profile
---
{% liquid
  function current_user = 'lib/data/queries/users/find', id: context.current_user.id

  assign template = "/profile/{slug}"
  assign query = context.location.pathname | extract_url_params: template

  unless query
    assign template = "/profile/{slug}/{section}"
    assign query = context.location.pathname | extract_url_params: template
  endunless

  function user = 'lib/data/queries/users/find', slug: query.slug

  unless user.id
    render 'theme/simple/404', status: 404
    break
  endunless

  assign section = query.section | default: 'activity'
  assign user_uuid = user.uuid | default: 'there-should-be'

  if section == 'activity'
    function list = 'lib/data/queries/activities/search', feed: 'user-public', feed_id: user.id, limit: 100
    function presigned_url = 'lib/data/queries/presigned_url'
  elsif section == 'groups'
    function list = 'lib/data/queries/relationships/search', limit: 20, name: 'membership', l_uuid: user_uuid
  elsif section == 'following'
    function list = 'lib/data/queries/relationships/search', limit: 20, name: 'followship', l_uuid: user_uuid
  elsif section == 'followers'
    function list = 'lib/data/queries/relationships/search', limit: 20, name: 'followship', r_uuid: user_uuid
  endif

  include 'theme/simple/profile/show', section: section, user: user, list: list, current_user: current_user, presigned_url: presigned_url
%}
